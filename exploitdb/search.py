import requests, json, os, re
import cve_searchsploit as CS

def search(sign):

  sign = re.sub('^/+', '', sign)
  url = "https://api.github.com/search/code"
  payload = {"q":sign+" repo:offensive-security/exploitdb"}
  res_json = requests.get(url, params=payload)
  res = json.loads(res_json.text)

  if res["total_count"]!=0:
    arr = {}
    for item in res["items"]:
      edbid = os.path.splitext(item['name'])[0]
      if not str.isdigit(edbid):
        continue
      cves = CS.cve_from_edbid(edbid)
      if len(cves)>0:
        for cve in cves:
          arr[cve] = 'https://www.exploit-db.com/exploits/'+edbid
      else:
        cve = "EDB-"+edbid
        arr[cve] = 'https://www.exploit-db.com/exploits/'+edbid
    return arr
  else:
    return []